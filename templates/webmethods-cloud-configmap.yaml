{{- if .Values.webMethodsCloud.enabled }}
# ============================================================================
# webMethods Cloud Configuration ConfigMap
# ============================================================================
# Contains tenant connections, accounts, and application configurations
# for webMethods.io Integration / Integration Cloud connectivity
#
# Files are mounted to: /opt/softwareag/IntegrationServer/config/integrationlive/
#
# Configuration approach:
# - accounts.cnf and connections.cnf are loaded from files/{environment}/integrationlive/
# - Application .cnf files are loaded from files/{environment}/integrationlive/applications/
# - All files preserve original format, timestamps, and state data
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "webmethods-msr.fullname" . }}-cloud-config
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "webmethods-msr.labels" . | nindent 4 }}
data:
  # ============================================================================
  # accounts.cnf - Tenant Account Configuration
  # ============================================================================
  # Loaded from files/{environment}/integrationlive/accounts.cnf
  # Contains: default, QA io, SMUD IC, Dev io accounts
  accounts.cnf: |
{{ .Files.Get (printf "files/%s/integrationlive/accounts.cnf" .Values.environment) | indent 4 }}

  # ============================================================================
  # connections.cnf - Tenant Connection Configuration
  # ============================================================================
  # Loaded from files/{environment}/integrationlive/connections.cnf
  # Contains: SMUD IC, default, QA io, Dev io connections
  connections.cnf: |
{{ .Files.Get (printf "files/%s/integrationlive/connections.cnf" .Values.environment) | indent 4 }}

  # ============================================================================
  # Application Configuration Files
  # ============================================================================
  # Loaded from files/{environment}/integrationlive/applications/ directory
  # ============================================================================
  {{- $appFiles := .Files.Glob (printf "files/%s/integrationlive/applications/*.cnf" .Values.environment) }}
  {{- range $path, $content := $appFiles }}
  {{ base $path }}: |
{{ $.Files.Get $path | indent 4 }}
  {{- end }}

  {{- /* Also support inline application files from values (for overrides) */}}
  {{- range $key, $value := .Values.webMethodsCloud.applicationFiles }}
  {{ $key }}: |
{{ $value | indent 4 }}
  {{- end }}
{{- end }}
