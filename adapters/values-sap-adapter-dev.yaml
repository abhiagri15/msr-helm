# ============================================================================
# SAP ADAPTER Configuration - Development Environment
# ============================================================================
# This file contains SAP Adapter connection and listener configurations.
# These connections are used for SAP system integration via RFC/BAPI.
#
# Usage:
#   helm upgrade --install wm-msr ./msr-helm \
#     -f values-dev.yaml \
#     -f adapters/values-sap-adapter-dev.yaml \
#     -n webmethods
#
# Connection Types:
#   - connNode_*: SAP RFC connections for outbound calls to SAP
#   - Listeners: SAP RFC listeners for inbound calls from SAP (IDoc, tRFC, etc.)
#
# Configuration approach:
#   - username: Stored in values file (not sensitive)
#   - password: Retrieved from Azure Key Vault via secretName
#   - Other connection details: Stored in values file
#
# SNC (Secure Network Communication):
#   - sncMode: Yes/No - Enable SNC for encrypted communication
#   - sncMyName: Client's SNC name (e.g., p:CN=ESBPROD, OU=IT, O=SMUD.ORG, C=US)
#   - sncPartnerName: SAP server's SNC name
#   - sncQualityOfService: Protection level (default: global settings)
#   - sncAuthentication: Authentication method (e.g., "User and Password")
#
# SNC Credentials:
#   cred_v2 and PSE files are stored in files/dev/sap_crypto/sec/
#   and mounted as a K8s Secret by the Helm chart.
#
# Passwords stored in Azure Key Vault:
#   - dev-sapadapter-customerprograms-password
#   - dev-sapadapter-rfcagency-password
# ============================================================================

sapAdapter:
  enabled: true

  # SAP SNC Library Path
  # This setting is injected into server.cnf for the SAP Adapter to recognize
  sncLibPath: "/opt/softwareag/sap/snc/sap_crypto/libsapcrypto.so"

  # SAP SNC External Credentials (cred_v2 + PSE from Helm chart files)
  snc:
    externalCredentials: true
    secretName: "sap-snc-credentials"

  # Package and folder where SAP connections are defined
  connectionPackageName: "SmSAPConn"
  connectionFolderName: "SmSAPConn"

  # Package and folder where SAP listeners are defined
  listenerPackageName: "SmSAPListeners"
  listenerFolderName: "SmSAPListeners"

  # ===========================================================================
  # SAP RFC Connections (outbound to SAP)
  # ===========================================================================
  connections:
    # -------------------------------------------------------------------------
    # CustomerPrograms_Conn - Direct connection to SAP RQ2 system
    # -------------------------------------------------------------------------
    - name: "connNode_CustomerPrograms_Conn"
      alias: "CustomerPrograms_Conn"
      enabled: false
      # SAP System Configuration
      appServerHost: "SAPRD2.SMUD.ORG"
      client: "010"
      systemId: "RQ2"
      systemNumber: "00"
      language: "EN"
      # Load Balancing Configuration (Off = direct to app server, On = use message server)
      loadBalancing: "Off"
      messageServerHost: "SAPRQ2.SMUD.ORG"
      logonGroup: "WEB"
      # Gateway Configuration (for RFC registration)
      gatewayHost: ""
      gatewayService: ""
      # Authentication - username in values, password from Azure Key Vault
      username: "SAP_RFC_USER"                          # Username in values file
      secretName: "sapadapter-customerprograms-password"  # Key Vault: dev-sapadapter-customerprograms-password
      passwordEnvVar: "SAP_CUSTOMERPROGRAMS_PASSWORD"   # Environment variable for password
      # SNC Configuration
      sncMode: "No"
      sncMyName: ""
      sncPartnerName: ""
      sncQualityOfService: "Use global build-in default settings"
      sncAuthentication: "User and Password"
      # Connection Options
      connectionType: "No"
      abapDebug: "Off"
      rfcTrace: "Off"
      sapGui: "Off"
      logTransactionStatus: "Off"
      storeMsgBody: "Off"
      repositoryServer: ""
      programId: ""
      routerString: ""
      # Pool Configuration
      minPoolSize: 0
      maxPoolSize: 10
      poolIncrementSize: 1
      blockTimeout: 1000
      expireTimeout: 1000
      startupRetryCount: 0
      startupBackoffSecs: 10

    # -------------------------------------------------------------------------
    # RFCAGENCY_Conn - Load balanced connection to SAP PRD system
    # -------------------------------------------------------------------------
    - name: "connNode_RFCAGENCY_Conn"
      alias: "RFCAGENCY_Conn"
      enabled: false
      # SAP System Configuration
      appServerHost: ""
      client: "010"
      systemId: "PRD"
      systemNumber: ""
      language: "EN"
      # Load Balancing Configuration
      loadBalancing: "On"
      messageServerHost: "sapprd.smud.org"
      logonGroup: "WEB"
      # Gateway Configuration
      gatewayHost: ""
      gatewayService: ""
      # Authentication - username in values, password from Azure Key Vault
      username: "RFCAGENCY"                             # Username in values file
      secretName: "sapadapter-rfcagency-password"       # Key Vault: dev-sapadapter-rfcagency-password
      passwordEnvVar: "SAP_RFCAGENCY_PASSWORD"          # Environment variable for password
      # SNC Configuration
      sncMode: "No"
      sncMyName: ""
      sncPartnerName: ""
      sncQualityOfService: "Use global build-in default settings"
      sncAuthentication: "User and Password"
      # Connection Options
      connectionType: "No"
      abapDebug: "Off"
      rfcTrace: "Off"
      sapGui: "Off"
      logTransactionStatus: "Off"
      storeMsgBody: "Off"
      repositoryServer: ""
      programId: ""
      routerString: ""
      # Pool Configuration
      minPoolSize: 1
      maxPoolSize: 10
      poolIncrementSize: 1
      blockTimeout: 1000
      expireTimeout: 1000
      startupRetryCount: 0
      startupBackoffSecs: 10

    # -------------------------------------------------------------------------
    # Add more SAP connections below as needed
    # -------------------------------------------------------------------------
    # - name: "connNode_NewConnection"
    #   alias: "NewConnection"
    #   enabled: false
    #   appServerHost: "sap-server.example.com"
    #   client: "100"
    #   systemId: "DEV"
    #   systemNumber: "00"
    #   language: "EN"
    #   loadBalancing: "Off"
    #   messageServerHost: ""
    #   logonGroup: ""
    #   gatewayHost: ""
    #   gatewayService: ""
    #   username: "SAP_USER"                           # Username in values file
    #   secretName: "sapadapter-newconn-password"      # Key Vault: dev-sapadapter-newconn-password
    #   passwordEnvVar: "SAP_NEWCONN_PASSWORD"         # Environment variable for password
    #   sncMode: "No"
    #   sncMyName: ""
    #   sncPartnerName: ""
    #   sncQualityOfService: "Use global build-in default settings"
    #   sncAuthentication: "User and Password"
    #   connectionType: "No"
    #   abapDebug: "Off"
    #   rfcTrace: "Off"
    #   sapGui: "Off"
    #   logTransactionStatus: "Off"
    #   storeMsgBody: "Off"
    #   repositoryServer: ""
    #   programId: ""
    #   routerString: ""
    #   minPoolSize: 0
    #   maxPoolSize: 10
    #   poolIncrementSize: 1
    #   blockTimeout: 1000
    #   expireTimeout: 1000
    #   startupRetryCount: 0
    #   startupBackoffSecs: 10

  # ===========================================================================
  # SAP RFC Listeners (inbound from SAP)
  # ===========================================================================
  listeners:
    # -------------------------------------------------------------------------
    # ESB Listener - Primary listener with SNC enabled
    # -------------------------------------------------------------------------
    - name: "ESB"
      enabled: false
      # Gateway Configuration (where to register RFC server)
      gatewayHost: "sapprd.smud.org"
      gatewayService: "sapgw00"
      # Program ID that SAP uses to call this listener
      programId: "ESB"
      # Repository connection for metadata
      repositoryServer: "RFCWEQ_Conn"
      # Thread pool size
      threadCount: 5
      unicode: "yes"
      # SNC Configuration
      sncMode: "Yes"
      sncMyName: "p:CN=ESBPROD, OU=IT, O=SMUD.ORG, C=US"
      sncQualityOfService: "Use global build-in default settings"
      # Logging
      rfcTrace: "Off"
      logTransactionStatus: "On"
      storeMsgBody: "On"
      authService: ""
      # Retry Configuration
      retryLimit: 5
      retryBackoffTimeout: 10

    # -------------------------------------------------------------------------
    # ESBCRM Listener - CRM system listener with SNC enabled
    # -------------------------------------------------------------------------
    - name: "ESBCRM"
      enabled: false
      gatewayHost: "sapcp1.smud.org"
      gatewayService: "sapgw00"
      programId: "ESBCRM"
      repositoryServer: "RFCWEQ_CRM_Conn"
      threadCount: 5
      unicode: ""
      sncMode: "Yes"
      sncMyName: "p:CN=ESBPROD, OU=IT, O=SMUD.ORG, C=US"
      sncQualityOfService: "Use global build-in default settings"
      rfcTrace: "Off"
      logTransactionStatus: "On"
      storeMsgBody: "On"
      authService: ""
      retryLimit: 5
      retryBackoffTimeout: 10

    # -------------------------------------------------------------------------
    # EPAService Listener - EPA service without SNC
    # -------------------------------------------------------------------------
    - name: "EPAService"
      enabled: false
      gatewayHost: "sapprd.smud.org"
      gatewayService: "sapgw00"
      programId: "EPAservice"
      repositoryServer: "RFCWEQ_Conn"
      threadCount: 5
      unicode: ""
      sncMode: "No"
      sncMyName: ""
      sncQualityOfService: "Use global build-in default settings"
      rfcTrace: "Off"
      logTransactionStatus: "On"
      storeMsgBody: "On"
      authService: ""
      retryLimit: 5
      retryBackoffTimeout: 10

    # -------------------------------------------------------------------------
    # Add more SAP listeners below as needed
    # -------------------------------------------------------------------------
    # - name: "NewListener"
    #   enabled: false
    #   gatewayHost: "sap-server.example.com"
    #   gatewayService: "sapgw00"
    #   programId: "NEWLISTENER"
    #   repositoryServer: "SomeConnection"
    #   threadCount: 5
    #   unicode: "yes"
    #   sncMode: "No"
    #   sncMyName: ""
    #   sncQualityOfService: "Use global build-in default settings"
    #   rfcTrace: "Off"
    #   logTransactionStatus: "On"
    #   storeMsgBody: "On"
    #   authService: ""
    #   retryLimit: 5
    #   retryBackoffTimeout: 10
